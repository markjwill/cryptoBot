from sklearn import preprocessing
import joblib
import os.path

scalerFileName = 'dataScalerV20221216.gz'

def batchScalerBuild(trades, scaler, scalerFileName):
  scaler = scaler.partial_fit(trades)
  joblib.dump(scaler, scalerFileName)

def normTrades(trades, scaler):
  return scaler.transform(trades)

def normTrade(trade, scaler):
  return scaler.transform([trade])

def deNormTrade(trade, scaler):
  return scaler.inverse_transform(trade)

def initScaler(scalerFileName):
  scaler = preprocessing.MaxAbsScaler()
  joblib.dump(scaler, scalerFileName)
  return scaler

if os.path.isfile(scalerFileName):
  scaler = joblib.load(scalerFileName)
else:
  scaler = initScaler(scalerFileName)

""" 
CREATE TABLE normedTrades (
  trade_id bigint(20) NOT NULL, 
  seconds_in_day_sin float NOT NULL, 
  seconds_in_day_cos float NOT NULL, 
  day_in_week_sin float NOT NULL, 
  day_in_week_cos float NOT NULL, 
  day_in_year_sin float NOT NULL, 
  day_in_year_cos float NOT NULL, 
  amount_traded float NOT NULL, 
  type float NOT NULL, 
  p_fiveSec_avgPrice float NOT NULL, 
  p_fiveSec_highPrice float NOT NULL, 
  p_fiveSec_lowPrice float NOT NULL, 
  p_fiveSec_startPrice float NOT NULL, 
  p_fiveSec_endPrice float NOT NULL, 
  p_fiveSec_changeReal float NOT NULL, 
  p_fiveSec_changePercent float NOT NULL, 
  p_fiveSec_travelReal float NOT NULL, 
  p_fiveSec_travelPercent float NOT NULL, 
  p_fiveSec_volumePrMin float NOT NULL, 
  p_fiveSec_tradesPrMin float NOT NULL, 
  p_fiveSec_buysPrMin float NOT NULL, 
  p_fiveSec_sellsPrMin float NOT NULL, 
  p_tenSec_avgPrice float NOT NULL, 
  p_tenSec_highPrice float NOT NULL, 
  p_tenSec_lowPrice float NOT NULL, 
  p_tenSec_startPrice float NOT NULL, 
  p_tenSec_endPrice float NOT NULL, 
  p_tenSec_changeReal float NOT NULL, 
  p_tenSec_changePercent float NOT NULL, 
  p_tenSec_travelReal float NOT NULL, 
  p_tenSec_travelPercent float NOT NULL, 
  p_tenSec_volumePrMin float NOT NULL, 
  p_tenSec_tradesPrMin float NOT NULL, 
  p_tenSec_buysPrMin float NOT NULL, 
  p_tenSec_sellsPrMin float NOT NULL, 
  p_thirtySec_avgPrice float NOT NULL, 
  p_thirtySec_highPrice float NOT NULL, 
  p_thirtySec_lowPrice float NOT NULL, 
  p_thirtySec_startPrice float NOT NULL, 
  p_thirtySec_endPrice float NOT NULL, 
  p_thirtySec_changeReal float NOT NULL, 
  p_thirtySec_changePercent float NOT NULL, 
  p_thirtySec_travelReal float NOT NULL, 
  p_thirtySec_travelPercent float NOT NULL, 
  p_thirtySec_volumePrMin float NOT NULL, 
  p_thirtySec_tradesPrMin float NOT NULL, 
  p_thirtySec_buysPrMin float NOT NULL, 
  p_thirtySec_sellsPrMin float NOT NULL, 
  p_oneMin_avgPrice float NOT NULL, 
  p_oneMin_highPrice float NOT NULL, 
  p_oneMin_lowPrice float NOT NULL, 
  p_oneMin_startPrice float NOT NULL, 
  p_oneMin_endPrice float NOT NULL, 
  p_oneMin_changeReal float NOT NULL, 
  p_oneMin_changePercent float NOT NULL, 
  p_oneMin_travelReal float NOT NULL, 
  p_oneMin_travelPercent float NOT NULL, 
  p_oneMin_volumePrMin float NOT NULL, 
  p_oneMin_tradesPrMin float NOT NULL, 
  p_oneMin_buysPrMin float NOT NULL, 
  p_oneMin_sellsPrMin float NOT NULL, 
  p_threeMin_avgPrice float NOT NULL, 
  p_threeMin_highPrice float NOT NULL, 
  p_threeMin_lowPrice float NOT NULL, 
  p_threeMin_startPrice float NOT NULL, 
  p_threeMin_endPrice float NOT NULL, 
  p_threeMin_changeReal float NOT NULL, 
  p_threeMin_changePercent float NOT NULL, 
  p_threeMin_travelReal float NOT NULL, 
  p_threeMin_travelPercent float NOT NULL, 
  p_threeMin_volumePrMin float NOT NULL, 
  p_threeMin_tradesPrMin float NOT NULL, 
  p_threeMin_buysPrMin float NOT NULL, 
  p_threeMin_sellsPrMin float NOT NULL, 
  p_fiveMin_avgPrice float NOT NULL, 
  p_fiveMin_highPrice float NOT NULL, 
  p_fiveMin_lowPrice float NOT NULL, 
  p_fiveMin_startPrice float NOT NULL, 
  p_fiveMin_endPrice float NOT NULL, 
  p_fiveMin_changeReal float NOT NULL, 
  p_fiveMin_changePercent float NOT NULL, 
  p_fiveMin_travelReal float NOT NULL, 
  p_fiveMin_travelPercent float NOT NULL, 
  p_fiveMin_volumePrMin float NOT NULL, 
  p_fiveMin_tradesPrMin float NOT NULL, 
  p_fiveMin_buysPrMin float NOT NULL, 
  p_fiveMin_sellsPrMin float NOT NULL, 
  p_tenMin_avgPrice float NOT NULL, 
  p_tenMin_highPrice float NOT NULL, 
  p_tenMin_lowPrice float NOT NULL, 
  p_tenMin_startPrice float NOT NULL, 
  p_tenMin_endPrice float NOT NULL, 
  p_tenMin_changeReal float NOT NULL, 
  p_tenMin_changePercent float NOT NULL, 
  p_tenMin_travelReal float NOT NULL, 
  p_tenMin_travelPercent float NOT NULL, 
  p_tenMin_volumePrMin float NOT NULL, 
  p_tenMin_tradesPrMin float NOT NULL, 
  p_tenMin_buysPrMin float NOT NULL, 
  p_tenMin_sellsPrMin float NOT NULL, 
  p_fifteenMin_avgPrice float NOT NULL, 
  p_fifteenMin_highPrice float NOT NULL, 
  p_fifteenMin_lowPrice float NOT NULL, 
  p_fifteenMin_startPrice float NOT NULL, 
  p_fifteenMin_endPrice float NOT NULL, 
  p_fifteenMin_changeReal float NOT NULL, 
  p_fifteenMin_changePercent float NOT NULL, 
  p_fifteenMin_travelReal float NOT NULL, 
  p_fifteenMin_travelPercent float NOT NULL, 
  p_fifteenMin_volumePrMin float NOT NULL, 
  p_fifteenMin_tradesPrMin float NOT NULL, 
  p_fifteenMin_buysPrMin float NOT NULL, 
  p_fifteenMin_sellsPrMin float NOT NULL, 
  p_thirtyMin_avgPrice float NOT NULL, 
  p_thirtyMin_highPrice float NOT NULL, 
  p_thirtyMin_lowPrice float NOT NULL, 
  p_thirtyMin_startPrice float NOT NULL, 
  p_thirtyMin_endPrice float NOT NULL, 
  p_thirtyMin_changeReal float NOT NULL, 
  p_thirtyMin_changePercent float NOT NULL, 
  p_thirtyMin_travelReal float NOT NULL, 
  p_thirtyMin_travelPercent float NOT NULL, 
  p_thirtyMin_volumePrMin float NOT NULL, 
  p_thirtyMin_tradesPrMin float NOT NULL, 
  p_thirtyMin_buysPrMin float NOT NULL, 
  p_thirtyMin_sellsPrMin float NOT NULL, 
  p_sixtyMin_avgPrice float NOT NULL, 
  p_sixtyMin_highPrice float NOT NULL, 
  p_sixtyMin_lowPrice float NOT NULL, 
  p_sixtyMin_startPrice float NOT NULL, 
  p_sixtyMin_endPrice float NOT NULL, 
  p_sixtyMin_changeReal float NOT NULL, 
  p_sixtyMin_changePercent float NOT NULL, 
  p_sixtyMin_travelReal float NOT NULL, 
  p_sixtyMin_travelPercent float NOT NULL, 
  p_sixtyMin_volumePrMin float NOT NULL, 
  p_sixtyMin_tradesPrMin float NOT NULL, 
  p_sixtyMin_buysPrMin float NOT NULL, 
  p_sixtyMin_sellsPrMin float NOT NULL, 
  p_oneTwentyMin_avgPrice float NOT NULL, 
  p_oneTwentyMin_highPrice float NOT NULL, 
  p_oneTwentyMin_lowPrice float NOT NULL, 
  p_oneTwentyMin_startPrice float NOT NULL, 
  p_oneTwentyMin_endPrice float NOT NULL, 
  p_oneTwentyMin_changeReal float NOT NULL, 
  p_oneTwentyMin_changePercent float NOT NULL, 
  p_oneTwentyMin_travelReal float NOT NULL, 
  p_oneTwentyMin_travelPercent float NOT NULL, 
  p_oneTwentyMin_volumePrMin float NOT NULL, 
  p_oneTwentyMin_tradesPrMin float NOT NULL, 
  p_oneTwentyMin_buysPrMin float NOT NULL, 
  p_oneTwentyMin_sellsPrMin float NOT NULL, 
  coinbase_price float NOT NULL, 
  binance_price float NOT NULL, 
  huobi_price float NOT NULL, 
  bittrex_price float NOT NULL, 
  bch_price float NOT NULL, 
  eth_price float NOT NULL, 
  f_fiveSec_endPrice float NOT NULL, 
  f_thirtySec_endPrice float NOT NULL, 
  f_fifteenMin_endPrice float NOT NULL, 
  f_oneTwentyMin_endPrice float NOT NULL
);
"""




